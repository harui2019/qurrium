[build-system]
requires = ["pytest", "cython", "setuptools", "setuptools-rust", "wheel"]
build-backend = "setuptools.build_meta"

# If you find some configurations are similar to what qiskit does,
# yes, it does. I 'learned' from them.

[tool.cibuildwheel]
skip = [
    # "pp*",
    "*-musllinux_i686", # rust tier 2 support
    "cp312-*",          # For some reason, it fails to build
    "*-manylinux_i686",
]
before-all = [
    'python -c "print(\"=\"*70)"',
    'python -c "print(\"### Building \".ljust(70, \".\"))"',
    'python -c "print(\"=\"*70)"',
]
before-test = [
    'python -c "print(\"=\"*70)"',
    'python -c "print(\"### Testing \".ljust(70, \".\"))"',
    'python -c "print(\"=\"*70)"',
    "pip install pytest",
]
test-command = ["pytest {project}"]

[tool.cibuildwheel.linux]
environment = { PATH = "$HOME/.cargo/bin:$PATH" }
before-all = [
    "curl https://sh.rustup.rs -sSf | sh -s -- --default-toolchain=nightly --profile=minimal -y",
    'source "$HOME/.cargo/env"',
    "rustup show",
]

[tool.cibuildwheel.macos]
before-all = ["rustup show"]
